<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Home Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="index.js"></script>
    <script th:inline="javascript">
        $(document).ready(function() {
            function updateTotalInCart() {
                $.ajax({
                    url: '/getTotalInCart',
                    method: 'GET',
                    success: function (totalInCart) {
                        // Update the HTML element with the new total in the cart
                        $('#totalInCart').text(totalInCart);
                    },
                    error: function () {
                        console.error('Error fetching total in cart');
                    }
                });
            }
            updateTotalInCart();

            // Handle form submission
            $('#addToCartForm, #removeFromCartForm').submit(function(event) {
                // Collect selected items
                var selectedItems = [];
                $('input[name="selectedItems"]:checked').each(function() {
                    selectedItems.push($(this).val());
                });

                // Add selected items to a hidden field within the form
                $('<input>').attr({
                    type: 'hidden',
                    name: 'selectedItems',
                    value: selectedItems.join(',')
                }).appendTo($(this)); // Append to the current form
            });
        });
    </script>
    <link rel="stylesheet" th:href="@{/css/general.css}" />
</head>
<body>
<div class="header">
    <h1>Online Book Store</h1>
</div>
<p th:text="'Logged in as: ' + ${user.getUsername()}" />
<div class="search-container">
    <form action="/listAvailableBooks">
        <input type="text" placeholder="Search" name="searchValue">
        <button type="submit">Submit</button>
    </form>
</div>

<div class="books-quantity">
    <h2>Total in Cart: <span th:id="totalInCart"></span></h2>
</div>

<div class="books-list">
    <h2>List of Books</h2>
</div>

<div class="container">
    <form th:action="@{/addToCart}" method="post" th:id="addToCartForm">
        <input type="submit" value="Add to Cart" class="button" />
    </form>
    <form th:action="@{/removeFromCart}" method="post" th:id="removeFromCartForm">
        <input type="submit" value="Remove from cart" class="button" />
    </form>
    <a href="checkout.html">
        <input type="submit" value="Checkout" class="button" />
    </a>
</div>

<div class="container">

    <table>
        <thead>
        <tr>
            <th>Select</th>
            <th>Cover</th>
            <th>Title</th>
            <th>Author</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="inventoryItem : ${inventoryItems}" th:if="${inventoryItem.quantity > 0}">
            <td><input type="checkbox" th:name="'selectedItems'" th:value="${inventoryItem.getId()}" /></td>
            <td>
                <img th:src="${inventoryItem.getBook().getCover()}" alt="Book Cover">
            </td>
            <td>
                <a th:href="@{/viewBook(isbn=${inventoryItem.getBook().getIsbn()})}" th:text="${inventoryItem.getBook().getTitle()}"></a>
            </td>
            <td th:text="${inventoryItem.getBook().getAuthor()[0].fullName}"></td>
        </tr>
        </tbody>
    </table>

    <p th:text="${error}" />

</div>
</body>
</html>
